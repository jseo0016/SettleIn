<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SettleIn ‚Äî Community</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0b1220; --card:#111a2e; --muted:#8ea2c8; --text:#eaf2ff;
      --brand:#6dd3a3; --brand-2:#8ab6ff; --ring: rgba(141,214,186,0.45);
      --border: rgba(255,255,255,.10);
    }
    :root[data-theme='light']{
      --bg:#f6f9ff; --card:#ffffff; --muted:#506289; --text:#0b1220;
      --brand:#2dd4bf; --brand-2:#60a5fa; --ring: rgba(96,165,250,0.45);
      --border: rgba(0,0,0,.10);
    }
    *{box-sizing:border-box}
    body{margin:0; font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial; background:var(--bg); color:var(--text); line-height:1.55; transition: background .3s, color .3s}
    a{color:inherit; text-decoration:none}
    .wrap{max-width:980px; margin:0 auto; padding:24px}

    header{position:sticky; top:0; backdrop-filter:saturate(1.2) blur(8px); background:linear-gradient(180deg, rgba(11,18,32,.85), rgba(11,18,32,.55)); border-bottom:1px solid var(--border); z-index:50}
    :root[data-theme='light'] header{background:rgba(255,255,255,0.9)}
    .nav{display:flex; align-items:center; justify-content:space-between; gap:18px; padding:16px 24px}
    .brand{display:flex; align-items:center; gap:10px; font-weight:700}
    .logo{width:34px; height:34px; background:conic-gradient(from 220deg,var(--brand),var(--brand-2)); border-radius:10px}
    .btn{display:inline-flex; align-items:center; gap:8px; padding:10px 12px; border-radius:12px; border:1px solid var(--border); background:var(--card); color:var(--text); cursor:pointer; transition:transform .2s ease, box-shadow .2s ease}
    .btn:hover{transform:translateY(-1px); box-shadow:0 6px 16px rgba(0,0,0,.18)}
    .cta{background:linear-gradient(90deg,var(--brand),var(--brand-2)); color:#fff; font-weight:700; padding:10px 14px; border-radius:12px; border:none; cursor:pointer}
    .theme-toggle{display:inline-flex; align-items:center; gap:8px; padding:8px 12px; border-radius:999px; border:1px solid var(--border); background:var(--card); color:var(--text)}

    /* Feed layout like Instagram */
    .feed{display:grid; grid-template-columns: minmax(0,1fr) 360px; gap:20px}
    .col-main{display:flex; flex-direction:column; gap:18px}
    .post{background:var(--card); border:1px solid var(--border); border-radius:16px; overflow:hidden}
    .post-h{display:flex; align-items:center; gap:10px; padding:12px 14px; border-bottom:1px solid var(--border)}
    .avatar{width:36px; height:36px; border-radius:50%; display:flex; align-items:center; justify-content:center; background:linear-gradient(120deg,var(--brand),var(--brand-2)); color:#fff; font-weight:700}
    .who{display:flex; flex-direction:column}
    .who small{color:var(--muted)}
    .img{width:100%; aspect-ratio:4/3; background:linear-gradient(120deg,var(--brand),var(--brand-2)); display:flex; align-items:center; justify-content:center; color:#fff; font-weight:800; font-size:32px}
    .post-b{padding:12px 14px}
    .row{display:flex; align-items:center; gap:10px; flex-wrap:wrap}
    .likes{font-weight:700}
    .caption{margin:6px 0 8px}
    .comment{display:flex; gap:8px; margin:8px 0}
    .comment .avatar{width:28px; height:28px; font-size:12px}
    .muted{color:var(--muted)}
    .divider{height:1px; background:var(--border); margin:8px 0}

    /* Composer + sidebar */
    .card{background:var(--card); border:1px solid var(--border); border-radius:16px; padding:14px}
    .composer .input{width:100%; border:1px solid var(--border); background:transparent; color:var(--text); border-radius:12px; padding:10px}
    .chips{display:flex; flex-wrap:wrap; gap:8px}
    .chip{background:var(--card); border:1px solid var(--border); padding:8px 10px; border-radius:999px; cursor:pointer}
    .chip.selected{outline:2px solid var(--ring)}
    .foot{margin:22px 0; font-size:12px; color:var(--muted)}

    @media(max-width:1000px){ .feed{grid-template-columns:1fr} }
  </style>
</head>
<body>
  <header>
    <div class="nav">
      <div class="brand"><div class="logo"></div> SettleIn</div>
      <div class="row">
        <a class="btn" href="index.html">‚Üê Home</a>
        <button id="themeToggle" class="theme-toggle">Theme</button>
      </div>
    </div>
  </header>

  <main class="wrap">
    <div class="feed">
      <section class="col-main" id="feed"></section>

      <aside class="col-side">
        <div class="card composer">
          <h3 style="margin:0 0 8px">Share a moment</h3>
          <p class="muted" style="margin:0 0 10px">Photo (URL) + caption. You can post anonymously.</p>
          <label style="display:block; font-weight:700; margin:6px 0 6px">Image URL</label>
          <input id="imgUrl" class="input" placeholder="Paste an image URL (e.g., from your phone album link)" />
          <label style="display:block; font-weight:700; margin:10px 0 6px">Caption</label>
          <textarea id="caption" class="input" rows="3" placeholder="What would you like to share?"></textarea>
          <div class="row" style="justify-content:space-between; margin-top:10px">
            <label class="row"><input type="checkbox" id="anonPost"> Post as Anonymous</label>
            <button id="postBtn" class="cta">Post</button>
          </div>
        </div>

        <div class="card" style="margin-top:14px">
          <h3 style="margin:0 0 8px">Filters</h3>
          <div class="chips" id="filters"></div>
        </div>

        <p class="foot">Photos & comments are stored locally on your device for this demo. In production, these go to your database with moderation.</p>
      </aside>
    </div>
  </main>

  <script>
    // Theme toggle
    (function(){
      const root=document.documentElement; const btn=document.getElementById('themeToggle');
      const saved=localStorage.getItem('settlein_theme'); if(saved && saved!=='dark') root.setAttribute('data-theme', saved);
      btn.addEventListener('click',()=>{ const next=root.getAttribute('data-theme')==='light'?'dark':'light'; if(next==='dark') root.removeAttribute('data-theme'); else root.setAttribute('data-theme','light'); localStorage.setItem('settlein_theme', root.getAttribute('data-theme')||'dark'); });
    })();

    // Demo data
    const CURRENT_USER = localStorage.getItem('settlein_alias') || 'You';
    const AVA = (name)=> name==='Anonymous' ? 'üôà' : (name[0]||'üôÇ').toUpperCase();
    const TAGS=['wins','study','food','nature','meetup','sport','art'];

    // Seed posts if empty
    const seed=[
      {id:'p1', user:'Kai', suburb:'Northcote', when:Date.now()-3600e3*5, img:'https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?q=80&w=1200&auto=format&fit=crop', caption:'First tram ride to the city! Any tips for budget eats near RMIT?', tags:['food','study'], likes:12, comments:[{user:'Ari', text:'Try the Queen Vic Market!'}, {user:'Anonymous', text:'Off-peak tram is quieter :)'}]},
      {id:'p2', user:'Emi', suburb:'St Kilda', when:Date.now()-3600e3*20, img:'https://images.unsplash.com/photo-1507525428034-b723cf961d3e?q=80&w=1200&auto=format&fit=crop', caption:'Sunset reset at the beach üåÖ', tags:['nature','wins'], likes:31, comments:[{user:'Jay', text:'Gorgeous!'}]},
      {id:'p3', user:'Ben', suburb:'Richmond', when:Date.now()-3600e3*30, img:'https://images.unsplash.com/photo-1554104707-a76b270e4bbb?q=80&w=1200&auto=format&fit=crop', caption:'Pick-up basketball behind the gym, 5pm Sunday ‚Äî all levels welcome.', tags:['sport','meetup'], likes:9, comments:[{user:'Gio', text:'I‚Äôm in!'}]}
    ];

    let posts=[];
    try{ posts = JSON.parse(localStorage.getItem('settlein_posts')||'[]'); }catch{}
    if(!posts.length){ posts = seed; localStorage.setItem('settlein_posts', JSON.stringify(posts)); }

    // Filters UI
    const filtersBox=document.getElementById('filters');
    const active=new Set();
    TAGS.forEach(t=>{ const b=document.createElement('button'); b.className='chip'; b.textContent='#'+t; b.onclick=()=>{ if(active.has(t)){ active.delete(t); b.classList.remove('selected'); } else { active.add(t); b.classList.add('selected'); } render(); }; filtersBox.appendChild(b); });

    const feed=document.getElementById('feed');

    function timeAgo(ms){ const s=Math.floor((Date.now()-ms)/1000); if(s<60) return s+'s'; const m=Math.floor(s/60); if(m<60) return m+'m'; const h=Math.floor(m/60); if(h<24) return h+'h'; const d=Math.floor(h/24); return d+'d'; }

    function postHTML(p){
      const who = p.user||'Anonymous';
      return `
        <article class="post" data-id="${p.id}">
          <div class="post-h">
            <div class="avatar">${AVA(who)}</div>
            <div class="who"><strong>${who}</strong><small class="muted">${p.suburb||'Melbourne'} ¬∑ ${timeAgo(p.when)}</small></div>
          </div>
          <div class="img" style="background:#0000">
            <img src="${p.img}" alt="${p.caption.replace(/"/g,'&quot;')}" style="width:100%; height:auto; display:block" onerror="this.parentNode.style.background='linear-gradient(120deg,var(--brand),var(--brand-2))'; this.remove()">
          </div>
          <div class="post-b">
            <div class="row" style="justify-content:space-between">
              <div class="row">
                <button class="btn like">‚ù§Ô∏è</button>
                <button class="btn comment-btn">üí¨</button>
                <button class="btn share">‚Üó</button>
              </div>
              <button class="btn report">Report</button>
            </div>
            <div class="likes" style="margin-top:6px">${p.likes||0} likes</div>
            <div class="caption"><strong>${who}</strong> ${p.caption}</div>
            <div class="muted" style="margin:6px 0">${(p.tags||[]).map(t=>'#'+t).join(' ')}</div>
            <div class="divider"></div>
            <div class="comments">
              ${(p.comments||[]).map(c=>`<div class='comment'><div class='avatar'>${AVA(c.user||'Anonymous')}</div><div><strong>${c.user||'Anonymous'}</strong> ${c.text}</div></div>`).join('')}
            </div>
            <div class="row" style="margin-top:8px">
              <input class="input" placeholder="Add a comment" style="flex:1; border:1px solid var(--border); background:transparent; color:var(--text); border-radius:12px; padding:8px 10px">
              <label class="row"><input type="checkbox" class="anonCk"> Anonymous</label>
              <button class="cta addComment">Post</button>
            </div>
          </div>
        </article>`;
    }

    function render(){
      let view = posts.slice();
      if(active.size) view = view.filter(p => (p.tags||[]).some(t=>active.has(t)));
      // newest first
      view.sort((a,b)=>b.when-a.when);
      feed.innerHTML = view.map(postHTML).join('');
    }

    // Posting
    document.getElementById('postBtn').addEventListener('click', ()=>{
      const img=document.getElementById('imgUrl').value.trim();
      const caption=document.getElementById('caption').value.trim();
      const anon=document.getElementById('anonPost').checked;
      if(!img || !caption){ alert('Please add an image URL and a caption.'); return; }
      const np={ id:'p'+(Date.now()), user: anon? 'Anonymous': CURRENT_USER, suburb:'Melbourne', when:Date.now(), img, caption, tags:[], likes:0, comments:[] };
      posts.unshift(np);
      localStorage.setItem('settlein_posts', JSON.stringify(posts));
      document.getElementById('imgUrl').value=''; document.getElementById('caption').value=''; document.getElementById('anonPost').checked=false;
      render(); window.scrollTo({top:0, behavior:'smooth'});
    });

    // Delegated interactions
    feed.addEventListener('click', (e)=>{
      const card=e.target.closest('.post'); if(!card) return; const id=card.dataset.id; const idx=posts.findIndex(p=>p.id===id); if(idx<0) return;
      if(e.target.matches('.like')){ posts[idx].likes=(posts[idx].likes||0)+1; localStorage.setItem('settlein_posts', JSON.stringify(posts)); render(); }
      if(e.target.matches('.report')){ alert('Thanks ‚Äî this will be reviewed.'); }
      if(e.target.matches('.share')){ navigator.clipboard?.writeText(location.href.split('#')[0]+`#${id}`); alert('Post link copied to clipboard'); }
      if(e.target.matches('.addComment')){
        const row=e.target.parentElement; const input=row.querySelector('.input'); const anon=row.querySelector('.anonCk').checked; const val=input.value.trim(); if(!val) return;
        posts[idx].comments=posts[idx].comments||[]; posts[idx].comments.push({user: anon? 'Anonymous': CURRENT_USER, text: val}); input.value=''; localStorage.setItem('settlein_posts', JSON.stringify(posts)); render();
      }
    });

    render();
  </script>
</body>
</html>
